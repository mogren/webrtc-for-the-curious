<!doctype html><html lang=ja dir=ltr><head><meta name=generator content="Hugo 0.74.3"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="デバッグ #  WebRTCのデバッグは、非常に困難な作業です。たくさんの可動部品があり、それらがすべて独立して壊れる可能性があります。注意していないと、間違ったものを探すために何週間もの時間を費やすことになります。やっと壊れた部品を見つけても、その原因を理解するためには、少し勉強する必要があります。
本章では、WebRTC をデバッグするための心構えを身につけます。問題をどのように分解するかを説明します。問題を把握した後は、一般的なデバッグツールを簡単にご紹介します。
問題の切り分け #  デバッグの際には、問題がどこから発生しているのかを切り分ける必要があります。問題の始まりから始めてみましょう。
シグナリングの失敗 #  ネットワーキングの失敗 #  netcatを使ってSTUNサーバーをテストします。
  20バイトのバインディングリクエストパケットを準備します。
echo -ne &#34;\x00\x01\x00\x00\x21\x12\xA4\x42TESTTESTTEST&#34; | hexdump -C 00000000 00 01 00 00 21 12 a4 42 54 45 53 54 54 45 53 54 |....!..BTESTTEST| 00000010 54 45 53 54 |TEST| 00000014 の解釈を行います。
  0001 はメッセージタイプ
  00 00 はデータセクションの長さです。
  21 12 a4 42 はマジック・クッキーです。
  54 45 53 54 54 45 53 54 54 45 53 54 (ASCIIでは TESTTESTTEST とデコードされます)は12バイトのトランザクションIDです。"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="デバッグ"><meta property="og:description" content="デバッグ #  WebRTCのデバッグは、非常に困難な作業です。たくさんの可動部品があり、それらがすべて独立して壊れる可能性があります。注意していないと、間違ったものを探すために何週間もの時間を費やすことになります。やっと壊れた部品を見つけても、その原因を理解するためには、少し勉強する必要があります。
本章では、WebRTC をデバッグするための心構えを身につけます。問題をどのように分解するかを説明します。問題を把握した後は、一般的なデバッグツールを簡単にご紹介します。
問題の切り分け #  デバッグの際には、問題がどこから発生しているのかを切り分ける必要があります。問題の始まりから始めてみましょう。
シグナリングの失敗 #  ネットワーキングの失敗 #  netcatを使ってSTUNサーバーをテストします。
  20バイトのバインディングリクエストパケットを準備します。
echo -ne &#34;\x00\x01\x00\x00\x21\x12\xA4\x42TESTTESTTEST&#34; | hexdump -C 00000000 00 01 00 00 21 12 a4 42 54 45 53 54 54 45 53 54 |....!..BTESTTEST| 00000010 54 45 53 54 |TEST| 00000014 の解釈を行います。
  0001 はメッセージタイプ
  00 00 はデータセクションの長さです。
  21 12 a4 42 はマジック・クッキーです。
  54 45 53 54 54 45 53 54 54 45 53 54 (ASCIIでは TESTTESTTEST とデコードされます)は12バイトのトランザクションIDです。"><meta property="og:type" content="article"><meta property="og:url" content="https://webrtcforthecurious.com/ja/docs/09-debugging/"><meta property="article:modified_time" content="2021-04-14T13:50:11+09:00"><meta property="og:site_name" content="好奇心旺盛な人のためのWebRTC"><title>デバッグ | 好奇心旺盛な人のためのWebRTC</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=alternate hreflang=en href=https://webrtcforthecurious.com/docs/09-debugging/ title=Debugging><link rel=alternate hreflang=tr href=https://webrtcforthecurious.com/tr/docs/09-debugging/ title=Debugging><link rel=alternate hreflang=zh href=https://webrtcforthecurious.com/zh/docs/09-debugging/ title=调试><link rel=stylesheet href=/book.min.6c7c6446dfdee7c8c933e9bbc6e80ee3ed6c913b2a59519f2092c3c6a9d63e55.css integrity="sha256-bHxkRt/e58jJM+m7xugO4+1skTsqWVGfIJLDxqnWPlU="><script defer src=/ja.search.min.ad4a454565aaf101139afc8cebb7f20e8751227002da7350788d6e933c9c8eb1.js integrity="sha256-rUpFRWWq8QETmvyM67fyDodRInAC2nNQeI1ukzycjrE="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/ja><span>好奇心旺盛な人のためのWebRTC</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=検索 aria-label=検索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://webrtcforthecurious.com/ja/docs/01-what-why-and-how/>何を、なぜ、どのように</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/02-signaling/>シグナリング</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/03-connecting/>接続</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/04-securing/>セキュリティ対策</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/05-real-time-networking/>リアルタイム・ネットワーキング</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/06-media-communication/>メディア・コミュニケーション</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/07-data-communication/>データ・コミュニケーション</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/08-applied-webrtc/>応用WebRTC</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/09-debugging/ class=active>デバッグ</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/10-history-of-webrtc/>歴史</a></li><li><a href=https://webrtcforthecurious.com/ja/docs/11-faq/>FAQ</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>デバッグ</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#問題の切り分け>問題の切り分け</a></li><li><a href=#tools-of-the-trade>Tools of the trade</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=デバッグ>デバッグ
<a class=anchor href=#%e3%83%87%e3%83%90%e3%83%83%e3%82%b0>#</a></h1><p>WebRTCのデバッグは、非常に困難な作業です。たくさんの可動部品があり、それらがすべて独立して壊れる可能性があります。注意していないと、間違ったものを探すために何週間もの時間を費やすことになります。やっと壊れた部品を見つけても、その原因を理解するためには、少し勉強する必要があります。</p><p>本章では、WebRTC をデバッグするための心構えを身につけます。問題をどのように分解するかを説明します。問題を把握した後は、一般的なデバッグツールを簡単にご紹介します。</p><h3 id=問題の切り分け>問題の切り分け
<a class=anchor href=#%e5%95%8f%e9%a1%8c%e3%81%ae%e5%88%87%e3%82%8a%e5%88%86%e3%81%91>#</a></h3><p>デバッグの際には、問題がどこから発生しているのかを切り分ける必要があります。問題の始まりから始めてみましょう。</p><h4 id=シグナリングの失敗>シグナリングの失敗
<a class=anchor href=#%e3%82%b7%e3%82%b0%e3%83%8a%e3%83%aa%e3%83%b3%e3%82%b0%e3%81%ae%e5%a4%b1%e6%95%97>#</a></h4><h4 id=ネットワーキングの失敗>ネットワーキングの失敗
<a class=anchor href=#%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%ad%e3%83%b3%e3%82%b0%e3%81%ae%e5%a4%b1%e6%95%97>#</a></h4><p>netcatを使ってSTUNサーバーをテストします。</p><ol><li><p><strong>20バイト</strong>のバインディングリクエストパケットを準備します。</p><pre><code>echo -ne &quot;\x00\x01\x00\x00\x21\x12\xA4\x42TESTTESTTEST&quot; | hexdump -C
00000000  00 01 00 00 21 12 a4 42  54 45 53 54 54 45 53 54  |....!..BTESTTEST|
00000010  54 45 53 54                                       |TEST|
00000014
</code></pre><p>の解釈を行います。</p><ul><li><p><code>0001</code> はメッセージタイプ</p></li><li><p><code>00 00</code> はデータセクションの長さです。</p></li><li><p><code>21 12 a4 42</code> はマジック・クッキーです。</p></li><li><p><code>54 45 53 54 54 45 53 54 54 45 53 54</code> (ASCIIでは <code>TESTTESTTEST</code> とデコードされます)は12バイトのトランザクションIDです。</p></li></ul></li><li><p>リクエストを送信し、<strong>32バイト</strong>のレスポンスを待ちます。</p><pre><code>stunserver=stun1.l.google.com;stunport=19302;listenport=20000;echo -ne &quot;\x00\x01\x00\x00\x21\x12\xA4\x42TESTTESTTEST&quot; | nc -u -p $listenport $stunserver $stunport -w 1 | hexdump -C
00000000  01 01 00 0c 21 12 a4 42  54 45 53 54 54 45 53 54  |....!..BTESTTEST|
00000010  54 45 53 54 00 20 00 08  00 01 6f 32 7f 36 de 89  |TEST. ....o2.6..|
00000020
</code></pre><p>の解釈を行います:</p><ul><li><p><code>01 01</code> はメッセージタイプ</p></li><li><p><code>00 0c</code> はデータセクションの長さで、10進数では12にデコードされます。</p></li><li><p><code>21 12 a4 42</code> は、マジッククッキーです。</p></li><li><p>そして、<code>54 45 53 54 54 45 53 54 54 45 53 54</code>（ASCIIでは<code>TESTTESTTEST</code>とデコードされる）は、12バイトのトランザクションIDです。</p></li><li><p><code>00 20 00 08 00 01 6f 32 7f 36 de 89</code> は 12 バイトのデータで解釈は次のようになります:</p><ul><li><p><code>00 20</code> はタイプ: <code>xor-mapped-address</code> です。</p></li><li><p><code>00 08</code> は値の部分の長さで、10進数では8にデコードされます。</p></li><li><p><code>00 01 6f 32 7f 36 de 89</code> はデータの値で、以下のように解釈します:</p><ul><li><p><code>00 01</code> はアドレスタイプ(IPv4)です</p></li><li><p><code>6f 32</code> は XOR マップされたポートです</p></li><li><p><code>7f 36 de 89</code> はXORマップされたIPアドレスです</p></li></ul></li></ul></li></ul></li></ol><p>XORマップされた部分を解読するのは面倒ですが、<code>00 00 00 00</code>に設定された(無効な)ダミーのマジッククッキーを与えることで、stunサーバを騙してダミーのXORマップを実行させることができます。</p><pre><code>stunserver=stun1.l.google.com;stunport=19302;listenport=20000;echo -ne &quot;\x00\x01\x00\x00\x00\x00\x00\x00TESTTESTTEST&quot; | nc -u -p $listenport $stunserver $stunport -w 1 | hexdump -C
00000000  01 01 00 0c 00 00 00 00  54 45 53 54 54 45 53 54  |........TESTTEST|
00000010  54 45 53 54 00 01 00 08  00 01 4e 20 5e 24 7a cb  |TEST......N ^$z.|
00000020
</code></pre><p>ダミーのマジッククッキーとのXORは冪等であるため、ポートとアドレスはレスポンスに明確に表示されます（IPアドレスをごまかして通過するパケットを操作するルータもあるため、すべての状況でこれが機能するわけではありません）。</p><ul><li><p><code>00 01 4e 20 5e 24 7a cb</code> がデータ値で、解釈は次のようになります:</p><ul><li><p><code>00 01</code> はアドレスタイプ（IPv4）です</p></li><li><p><code>4e 20</code> はマップされたポートで，10進数で 20000 にデコードされます</p></li><li><p><code>5e 24 7a cb</code> は IP アドレスで，ドット 10 進表記では <code>94.36.122.203</code> となります</p></li></ul></li></ul><h4 id=セキュリティの失敗>セキュリティの失敗
<a class=anchor href=#%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%81%ae%e5%a4%b1%e6%95%97>#</a></h4><h4 id=メディアの障害>メディアの障害
<a class=anchor href=#%e3%83%a1%e3%83%87%e3%82%a3%e3%82%a2%e3%81%ae%e9%9a%9c%e5%ae%b3>#</a></h4><h4 id=データの障害>データの障害
<a class=anchor href=#%e3%83%87%e3%83%bc%e3%82%bf%e3%81%ae%e9%9a%9c%e5%ae%b3>#</a></h4><h3 id=tools-of-the-trade>Tools of the trade
<a class=anchor href=#tools-of-the-trade>#</a></h3><h4 id=netcat-nc>netcat (nc)
<a class=anchor href=#netcat-nc>#</a></h4><p><a href=https://en.wikipedia.org/wiki/Netcat>netcat</a>は、TCP や UDP を使ったネットワーク接続を読み書きするためのコマンドラインネットワークユーティリティです。主に <code>nc</code> コマンドとして利用できます。</p><h4 id=tcpdump>tcpdump
<a class=anchor href=#tcpdump>#</a></h4><p><a href=https://en.wikipedia.org/wiki/Tcpdump>tcpdump</a> は、コマンドラインのデータネットワークパケットアナライザです。</p><p>一般的なコマンドです。</p><ul><li><p>19302 番ポートとの間の UDP パケットをキャプチャし、パケットの内容を 16 進数で表示します。</p><p><code>sudo tcpdump 'udp port 19302' -xx</code></p></li><li><p>同じくパケットをPCAP(packet capture)ファイルに保存して後で確認する。</p><p><code>sudo tcpdump 'udp port 19302' -w stun.pcap</code></p><p>PCAPファイルは、wiresharkのGUIで開くことができます。<code>wireshark stun.pcap</code> です。</p></li></ul><h4 id=wireshark>wireshark
<a class=anchor href=#wireshark>#</a></h4><h4 id=webrtc-internals>webrtc-internals
<a class=anchor href=#webrtc-internals>#</a></h4></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
日本語</li></ul><ul class=book-languages-list><li><a href=https://webrtcforthecurious.com/docs/09-debugging/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=https://webrtcforthecurious.com/tr/docs/09-debugging/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Turkish</a></li><li><a href=https://webrtcforthecurious.com/fa/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Persian</a></li><li class=active><a href=https://webrtcforthecurious.com/ja/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
日本語</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/09-debugging/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
简体中文</a></li></ul></div><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/commit/dc11c2ff3d8d11b30af6cfa81458c3507f77b452 title="最終更新者 Hiroyuki Sato | April 14, 2021" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>April 14, 2021</span></a></div><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/edit/master/content.ja/docs/09-debugging.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>このページを編集する</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#問題の切り分け>問題の切り分け</a></li><li><a href=#tools-of-the-trade>Tools of the trade</a></li></ul></li></ul></nav></div></aside></main></body></html>